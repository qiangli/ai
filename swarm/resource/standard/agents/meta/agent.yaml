###
pack: "meta"
agents:
  - name: "workspace"
    display: "ðŸ¤– Workspace"
    description: |
      Describes the current workspace layout and where key state is stored.
      Intended to be embedded into other agents' instructions.
    instruction: |
      #! --mime-type=text/x-go-template
      Your `workspace` root:
      {{.workspace}}

      CRITICAL: Before answering or delegating, decide whether the user is
      referring to prior work or expects you to continue from earlier context.
      If the user refers to/depends on previous conversations, prior tool runs,
      earlier decisions, or says/implicitly implies things like "as we discussed",
      "continue", "same issue", "that change", "the previous patch", etc., you MUST
      look up historical context BEFORE proceeding. Use these sources as needed.

      Key subfolders (conventions):
      - /memory/  : long-term memory (preferences/notes/todos). Long-lived notes and decisions that should persist across sessions.
      - /history/ : chat history (same source as ai:list_messages). Each message has a unique ID, but shares the same session ID for the same chat thread, stored as the "session" field. Past conversations and continuity context.
      - /var/log/chat/ : console-visible transcript, saved as `session_<id>.log` using the session ID.
      - /var/log/toolcall/session_<id>/* : detailed tool call logs, organized in folders named `session_<id>` using the session ID.

      Usage guidance:
      - Prefer reading memory/ first for canonical decisions before changing behavior.
      - When adding new durable facts, write a short note under memory/.
      - When troubleshooting, consult toolcall/ to see what was executed.
      - For most tasks, start by calling ai:list_messages (recent)
        and consult long-term memory via the embedded memory agent; expand/lookup logs if the query indicates missing details.

      For reference, today's date is: {{date}}.

  # - name: "ðŸ¤– save_result"
  #   display: "Save response in the environment"
  #   description: |
  #     Use the `sh:set_envs` tool to store the response with a key.
  #   parameters:
  #     type: "object"
  #     properties:
  #       result_key:
  #         type: "string"
  #         description: "Absolute path to the workspace root."
  #         default: "result"
  #     required:
  #       - "result_key"
  #   instruction: |
  #     #! --mime-type=text/x-go-template
  #     *** Important ***
  #     You must save the response using the `sh:set_envs` tool with `{{default "result" .result_key}}` as the key.
  #     Ensure the values are correctly stored by using the `sh:get_envs` tool to verify.
  #     ###
  #   functions:
  #     - "sh:set_envs"
  #     - "sh:get_envs"
