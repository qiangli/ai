###
kit: "sh"
tools:
  - name: "pass"
    description: |
      A no-operation (no-op) tool that performs no actions. 
      Ideal for scenarios requiring a placeholder or testing phase 
      where subsequent processes are needed without executing any specific tasks.
    parameters: {}
    type: "system"

  - name: "fail"
    description: |
      This tool simulates an error for testing purposes.
      It can be used to evaluate error handling and response mechanisms.
    parameters:
      type: "object"
      properties:
        report:
          type: "string"
          description: "A customizable message that is displayed when the error is produced. This field is optional."
    type: "system"

  - name: "exec"
    description: |
      Execute a specified command within the user's environment.
      Ensure the command is specified as a command line string. Security restrictions may apply.
    parameters:
      type: "object"
      properties:
        command:
          type: "string"
          description: "The command to execute as a command line string."
      required:
        - command
    type: "system"

  - name: "cd"
    description: |
      *Unsupported Command*: Changing the current working directory is not supported.
      Use absolute paths for accessing directories and files.
      Run the 'fs:list_roots' tool to identify allowed top-level directories.
      For legacy bash scripts relying on `cd`, use the 'sh:exec' tool, e.g., sh:exec --command "/bin/bash </script/file>"
    parameters: {}
    type: "system"

  - name: "pwd"
    description: "Print the current working directory on user's system."
    parameters: {}
    type: "system"

  - name: "workspace"
    description: "Print the primary workspace directory for the user."
    parameters: {}
    type: "system"

  - name: "format"
    description: |
      Specifies the format or a custom template for the output.
    type: "system"
    parameters:
      type: "object"
      properties:
        output:
          type: "string"
          description: |
            The destination for the formatted output. Defaults to the console.
            Accepts a URI. Currently supported scheme: "file:"
        template:
          type: "string"
          description: |
            A custom template to apply to the data. If not provided, default templates
            are used based on the format: json, markdown, or raw.
            It can be a file path or an inline string prefixed with "data:.".

  - name: "parse"
    description: |
      Parses an input command line into a `map[string]any` format and validate.
    type: "system"
    parameters:
      type: "object"
      properties:
        command:
          type: "string"
          description: |
            Specifies the command line to be parsed.
      required:
        - command

  - name: "serve_loop"
    display: "AI Serve Loop (clipboard/stdin loop)"
    description: |
      Runs an interactive infinite loop that reads input, executes an AI action, and writes output.

      Default behavior:
        - input: clipboard
        - output: clipboard + stdout
        - format: raw

      For stdin/stdout mode, it always prints an "ai> " prompt for both input and output.

      Termination:
        - Ctrl+C exits in foreground mode.
        - In background mode, responds to SIGTERM/SIGINT.
    type: "system"
    parameters:
      type: "object"
      properties:
        # raw (default) or markdown
        format:
          type: "string"
          enum: ["raw","markdown"]
          description: "Output format. raw (default) or markdown"
        # clipboard (default), stdin, or file
        input:
          type: "string"
          description: "Input source: clipboard (default), or stdin"
        # a list of destinations, defaults: clipboard + stdout
        output:
          type: "array"
          items:
            type: "string"
          description: "Output destinations: clipboard, stdout, and/or file:/path"
        # detach and run under nohup
        background:
          type: "boolean"
          description: "Detach from terminal and run in background (nohup style)."
        # action to run each iteration (defaults to agent/root)
        action:
          type: "string"
          description: "Action to execute per request."
          default: "agent:root/root"
        # for clipboard mode: poll interval when unchanged
        poll:
          type: "string"
          description: "Polling interval for clipboard changes (e.g. 300ms, default: 1s)."
        trigger:
          type: "string"
          description: |
            Trigger word(s) for clipboard/file input mode. Optional for stdin.

            Default triggers: "ai", "#ai", "//ai".

            In clipboard/file mode, only inputs whose first non-blank token matches a trigger will be processed;
            otherwise the input is ignored and a message is emitted.

            Examples: "ai", "#ai", "//ai", or custom like "ask".
        # optional: stop if clipboard content equals last response
        dedupe:
          type: "boolean"
          description: "Skip processing when input hasn't changed (default true)."
          default: "true"
      required: []

  - name: "timeout"
    description: |
      Run action with a time limit.
      An action could be a system command, a tool, or an agent.
    type: "system"
    parameters:
      type: "object"
      properties:
        command:
          type: "string"
          description: |
            The action with arguements to run.
            Format:
              ACTION [OPTIONS] ... 
            Example:
              timeout /bin/ls
              timeout /sh:bash --script "data:,#!\n/bin/ls /tmp"
              timeout /agent:joker --message "tell me a joke"

            Start the action with options, and cancel it if still running after the specified duration.
        duration:
          type: "string"
          description: |
            Duration is a number with an optional suffix: 's'
            for seconds (the default), 'm' for minutes, 'h' for hours, or 'd'
            for days.  
            A duration of 0 disables the associated timeout.
      required:
        - command

  - name: "backoff"
    description: |
      Run an action command, repeatedly, until it succeeds or we are out of time.
    type: "system"
    parameters:
      type: "object"
      properties:
        command:
          type: "string"
          description: |
            The action with arguements to run.
        duration:
          type: "string"
          description: |
            Duration is a number with an optional suffix: 's'
            for seconds (the default), 'm' for minutes, 'h' for hours, or 'd' for days.

            Examples:
            + System command action
            /sh:backoff --command "/sh:exec --command 'printenv'"  --option duration="10s"
            + Tool action
            /sh:backoff --command "/fs:list_roots"  --option duration="10s"
            + Agent action
            /sh:backoff --command "/agent:ed/ed --adapter echo"  --option duration="10s"
      required:
        - command
