###
kit: "flow"
type: "system"

tools:
  - name: "help"
    display: "Flow Tool Kit Help"
    description: |
      `flow:*` is a set of tools for executing actions in a controlled fashion:

      + sequence: Execute actions consecutively, the response of each action is set as "result" in the input arguments of the next action.
      + choice: Randomly select and execute a single action from the list.
      + parallel: Execute all actions simultaneously and return their results as a combined list.
      + loop: Repeatedly executes all specified actions in a loop. The loop can run indefinitely or for a limited number of iterations.
      + chain: Executes a series of actions consecutively. Chain actions ["a1", "a2", "a3", ...] translate to nested function calls: a1(a2(a3(...)))
      + fallback: Executes actions in sequence. Return the result of the first successfully executed action, or produce an error from the final action if all actions fail.
    parameters: {}
    type: "func"
    body:
      mime_type: "text/x-go-template"
      script: |
        #! --mime-type=text/x-go-template
        A set of tools for executing actions in a controlled fashion:

        + sequence: the response of each action is set as "result" in the input arguments of the next action.
        + choice: Randomly select and execute a single action from the list of actions.
        + parallel: Execute all actions simultaneously and return their results as a combined list.
        + loop: Repeatedly executes all specified actions in a loop. The loop can run indefinitely or for a limited number of iterations.
        + chain: Executes a series of actions consecutively. Chain actions ["a1", "a2", "a3", ...] translate to nested function calls: a1(a2(a3(...)))
        + fallback: Executes actions in sequence. Return the result of the first successfully executed action, or produce an error from the final action if all actions fail.

        ## Actions
          A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
          Specify actions in the following formats:
          - Tool action: `kit:name`
          - Agent action: `agent:pack/name`  All agents belong to the "agent" kit.

        ## Examples
          Example for tool: `fs:read_file`

          /flow:sequence --actions '["fs:read_file"]'

          Examples for agent: `agent:ask`, `agent:memory/lastn`

          /flow:sequence --actions '["agent:memory/lastn", "agent:ask"]'

          Note: `fs:read_file` should be from the list obtained using list_tools, 
          while `agent:ask` and `agent:memory/lastn` should be from list_agents.

          Tools and agents can be mixed in the actions.
          Additional arguments may be required for each action.
          To explore the required arguments and further specifics of an action,
          use "ai:get_agent_info" for agents and "ai:get_tool_info" for tools.
          They will provide detailed information about the parameters and usage guidelines.
    log_level: "quiet"

  - name: "sequence"
    description: |
      the response of each action is set as "result" in the input arguments of the next action.
      Return the result from the last action or error from the first action that failed.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`

            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details

            Example:
            /flow:sequence --actions '["sh:pwd","sh:format"]' --template "data:,***got from 'pwd': {{.result}}***\n"
      required:
        - actions

  - name: "choice"
    description: |
      Randomly select and execute one single action from the list of actions.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`

            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details

            Example:
            /flow:choice --actions "[sh:pwd,sh:pass]"
      required:
        - actions

  - name: "parallel"
    description: |
      Execute all actions simultaneously and return their results as a combined list.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`

            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details

            Example:
            /flow:parallel --actions "[sh:pwd,sh:pass]"
      required:
        - actions

  - name: "loop"
    description: |
      Repeatedly executes all specified actions in a loop.
      The loop can run indefinitely or for a limited number of iterations.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            List of valid actions. Use `ai:list_tools` or `ai:list_agents` to view available actions.
            Actions can be specified as:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`

            Actions may require additional arguments.
            Use `/flow:help` for more details.

            Example:
            /flow:loop --actions "[sh:pass]" --max-iteration 3 --sleep 1s --report "Runing in a loop"
        max_iteration:
          type: integer
          description: Maximum number of iterations. If not set, runs indefinitely.
        sleep:
          type: "string"
          description: |
            Pauses execution between iterations for a specified duration in seconds, minutes, hours, or days. 
            Accepted formats include: '10' (seconds), '10s', '5m', '2h', '1d'. 
            Defaults to '3s' if no suffix is provided.
          default: "3s"
          minimum: "1s"
        report:
          type: "string"
          description: "An optional message to display before each iteration."
      required:
        - actions

  - name: "fallback"
    description: |
      Execute a series of actions in sequence. 
      Return the result of the first successfully executed action, or produce an error from the final action if all actions fail.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`

            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details

            Example:
            /flow:fallback --actions "[sh:fail,sh:pass]"
      required:
        - actions

  - name: "chain"
    description: |
      Execute a series of actions consecutively, similar to the `sequence` flow.
      The chain returns the result or error from the final action executed.
      Chain actions ["a1", "a2", "a3", ...] translate to nested function calls: a1(a2(a3(...))).
      Each action in the chain should accept a sub-action through the "action" parameter.
    parameters:
      type: "object"
      properties:
        chain:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to view available actions.
            Specify actions in these formats:
            - Tool action: `kit:name`, e.g., fs:read_file for the "read_file" tool in the "fs" (file system) kit.
            - Agent action: `agent:pack/sub`, e.g., pack/sub represents the agent's name, where all agents belong to the "agent" kit.

            You can mix tools and agents in the action chain.
            Additional arguments might be necessary for each action.
            Use `flow:help`, `ai:get_tool_info`, and `ai:get_agent_info` for more information.

            Example:
            /flow:chain --chain "[sh:timeout,sh:backoff,alias:cmd]" \
                --option cmd="/flow:choice --actions=[sh:pass,sh:fail]" \
                --option duration="60s" \
                --option report="sh:fail was called"

      required:
        - chain
