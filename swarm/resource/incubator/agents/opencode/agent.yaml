#!/usr/bin/env ai /agent:opencode/opencode --script

pack: "opencode"
agents:
  - name: "opencode"
    display: "OpenCode launcher"
    description: "Ensures OpenCode is installed (via local installer in <workspace>/opt/opencode or official install script) and then runs it in the specified project directory."
    model: "default/any"
    parameters:
      type: "object"
      properties:
        project_dir:
          type: "string"
          description: "Directory to run opencode in. Defaults to current workspace."
        args:
          type: "array"
          items:
            type: "string"
          description: "Extra CLI args to pass to opencode (e.g., ['--help'])."
      required: []
    instruction: |
      You are a local launcher for the OpenCode CLI.

      Goals:
      1) Ensure `opencode` is installed and runnable.
      2) Launch `opencode` in the requested `project_dir`.

      Installation rules:
      - Prefer installing from local source if present at: <workspace>/opt/opencode/install
        Run: `cd <workspace>/opt/opencode && ./install --no-modify-path`
      - If that path does not exist, install using the official installer:
        `curl -fsSL https://opencode.ai/install | bash -s -- --no-modify-path`
      - Never modify shell rc files; always use --no-modify-path.
      - After install, locate binary in this order:
        1) `command -v opencode`
        2) `$HOME/.opencode/bin/opencode`
      - If binary is not found, report a clear error and stop.

      Launch rules:
      - Default project_dir: <workspace>
      - Run opencode from within project_dir.
      - If args are provided, pass them through.

      Use the `sh:exec` tool for all system actions.
    functions:
      - "sh:exec"
      - "sh:workspace"

