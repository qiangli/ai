###
kit: "flow"
type: "system"

tools:
  - name: "help"
    display: "Flow Tool Kit Help"
    description: |
      A set of tools for executing actions in a controlled fashion:
      
      + sequence: Execute actions consecutively, using the result of each action as the input for the next one.
      + choice: Randomly select and execute a single action from the list.
      + parallel: Execute all actions simultaneously and return their results as a combined list.
      + map: Apply the specified actions to each item in the input array, producing a new array. Actions are executed in sequence for each array element.
    parameters: {}
    type: "func"
    body:
      mime_type: "text/x-go-template"
      script: |
        #!
        A set of tools for executing actions in a controlled fashion:

        + sequence: Execute actions consecutively, using the result of each action as the input for the next one.
        + choice: Randomly select and execute a single action from the list of actions.
        + parallel: Execute all actions simultaneously and return their results as a combined list.
        + map: Apply the specified actions to each item in the input array, producing a new array. Actions are executed in sequence for each array element.
        
        ## Actions
          A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
          Specify actions in the following formats:
          - Tool action: `kit:name`
          - Agent action: `agent:pack/name`  All agents belong to the "agent" kit.

        ## Examples
          Example for tool: `fs:read_file`

          /flow:sequence --actions '["fs:read_file"]'

          Examples for agent: `agent:ask`, `agent:memory/lastn`

          /flow:sequence --actions '["agent:memory/lastn", "agent:ask"]'

          Note: `fs:read_file` should be from the list obtained using list_tools, 
          while `agent:ask` and `agent:memory/lastn` should be from list_agents.

          Tools and agents can be mixed in the actions.
          Additional arguments may be required for each action.
          To explore the required arguments and further specifics of an action,
          use "ai:get_agent_info" for agents and "ai:get_tool_info" for tools.
          They will provide detailed information about the parameters and usage guidelines.
    log_level: "quiet"

  # - name: "flow"
  #   description: |
  #     Execute a specified list of actions within the user's environment.
  #     Ensure that the actions are provided as an array, keeping in mind any security restrictions.
  #   parameters:
  #     type: "object"
  #     properties:
  #       flow_type:
  #         type: "string"
  #         description: |
  #           Defines how the actions in the flow are executed. Supported types include:
  #           + sequence: Execute actions consecutively, using the result of each action as the input for the next one.
  #           + choice: Randomly select and execute a single action from the list.
  #           + parallel: Execute all actions simultaneously and return their results as a combined list.
  #           + map: Apply the specified actions to each item in the input array, producing a new array. Actions are executed in sequence for each array element.
  #       query:
  #         type: "string"
  #         description: "The input query string"
  #       actions:
  #         type: "array"
  #         items:
  #           type: "string"
  #         description: |
  #           A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
  #           Specify actions in the following formats:
  #           - Tool action: `tool:kit:name`
  #           - Agent action: `agent:pack/name`

  #           Example for tool: `fs:read_file`
  #           Examples for agent: `agent:ask`, `agent:memory/lastn`
  #           Note: `fs:read_file` should be from the list obtained using list_tools, 
  #           while `agent:ask` and `agent:memory/lastn` should be from list_agents.

  #           Additional arguments may be required for each action.
  #           To explore the required arguments and further specifics of an action,
  #           use "ai:get_agent_info" for agents or "ai:get_tool_info" for tools.
  #           This will provide detailed information about the parameters and usage guidelines.
  #     required:
  #       - actions
  
  - name: "sequence"
    description: |
      Execute actions consecutively, using the result of each action as the input for the next one.
      Return the result from the last action or error from the first action that failed.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`
            
            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details
      required:
        - actions
    
  - name: "choice"
    description: |
      Randomly select and execute one single action from the list of actions.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`
            
            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details
      required:
        - actions
    
  - name: "parallel"
    description: |
      Execute all actions simultaneously and return their results as a combined list.
    parameters:
      type: "object"
      properties:
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`
            
            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details
      required:
        - actions

  - name: "map"
    description: |
      Apply the specified actions to each item in the input array, producing a new array.
      Actions are executed in sequence for each array element.
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "The input query string in json array format"
        actions:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to acquire available actions.
            Specify actions in the following formats:
            - Tool action: `tool:kit:name`
            - Agent action: `agent:pack/name`
            
            Tools and agents can be mixed in the actions.
            Additional arguments may be required for each action.
            Use `/flow:help` for more details
      required:
        - query
        - actions
  
  - name: "chain"
    description: |
      Execute a series of actions consecutively, similar to the `sequence` flow.
      The chain returns the result or error from the final action executed.
      Chain actions ["a1", "a2", "a3", ...] translate to nested function calls: a1(a2(a3(...))).
      Each action in the chain should accept a sub-action through the "action" parameter.
    parameters:
      type: "object"
      properties:
        chain:
          type: "array"
          items:
            type: "string"
          description: |
            A list of valid actions. Use `ai:list_tools` or `ai:list_agents` to view available actions.
            Specify actions in these formats:
            - Tool action: `kit:name`, e.g., fs:read_file for the "read_file" tool in the "fs" (file system) kit.
            - Agent action: `agent:pack/sub`, e.g., pack/sub represents the agent's name, where all agents belong to the "agent" kit.
            
            You can mix tools and agents in the action chain.
            Additional arguments might be necessary for each action.
            Use `flow:help`, `ai:get_tool_info`, and `ai:get_agent_info` for more information.
      required:
        - chain
  