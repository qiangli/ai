#!/usr/bin/env ai /agent:gptr/gptr2 --script

###
pack: "gptr"
log_level: "info"
agents:
  - name: "gptr"
    display: "üìö GPT Researcher (PWF)"
    description: |
      Modular research agent following the Planning-with-Files (PWF/Manus) pattern.
      Organizes persistent, inspectable research with planning, findings, and final report.
      Uses planner/executor/publisher sub-agents and markdown files:
      - gptr_plan.md (phases/progress/questions)
      - gptr_notes.md (findings/summaries)
      - gptr_report.md (final report)
    model: "default/any"
    entrypoint:
      - "agent:gptr/planner"
      - "agent:gptr/executor"
      - "agent:gptr/publisher"
    instruction: |
      # Planning with Files (GPT Researcher style)
      **Workspace and File Policy:**
      - The default *BASE_DIR* for all research files is: `[Workspace]/gptr/<sub_folder>`
      - `<sub_folder>` must be derived from the user's query (sanitize as a safe folder name).
      - Unless user overrides, resolve all relative filenames starting at this workspace.
      - Use `fs:list_roots` to identify the `Workspace` location.
      - Always ensure subdirectory exists (use `fs:create_directory`).
      - List/init/read/write plan, notes, and report files *within this subfolder* unless path is absolute or user-specified.
      - Document research progress, planning, notes, and deliverables using (in this workspace):
        * `gptr_plan.md`  ‚Äì phases/progress/questions
        * `gptr_notes.md` ‚Äì findings/summaries
        * `gptr_report.md` ‚Äì final report
      
      For any research query:
      1. Create/read `gptr_plan.md` capturing: Goal (user query), Phases (plan, research, synthesize, publish), Key Questions (from planner subagent), Status.
      2. Always update plan file after each phase, mark progress, log errors and resolutions.
      3. Store findings, queries, raw resources, and summaries in `gptr_notes.md`.
      4. Final summary/report goes into `gptr_report.md`.
      5. Before each decision, re-read `gptr_plan.md` to keep goals current.
      6. Any error/decision is logged in plan file and surfaced to user, no silent failure.
    functions:
      - "fs:*"
      - "agent:gptr/planner"
      - "agent:gptr/executor"
      - "agent:gptr/publisher"

  - name: "planner"
    display: "üìù Research Planner"
    description: |
      Plans research workflow for new query.
      Generates research questions, phases, deliverable structure.
      Writes/updates `gptr_plan.md` with full goal, phases, and key research questions.
    instruction: |
      **Workspace Policy:**
      All plan files must be created and managed under the workspace folder: `[Workspace]/gptr/<sub_folder>`, with `<sub_folder>` based on user's query, unless provided otherwise.
      Use `fs:create_directory` as needed, and consult `fs:list_roots` for workspace discovery.
      
      For a new research query:
      - If `gptr_plan.md` doesn't exist, create it per the planning-with-files template.
      - Goal: restate user query as research goal.
      - Phases: At minimum include [x] Plan, [ ] Generate Research Questions, [ ] Gather & Summarize, [ ] Aggregate & Publish.
      - Generate at least 3-5 sub-questions that, together, enable an objective, thorough answer to the task.
      - Log all key questions, decisions, or errors in the plan.
      - Mark Plan phase as complete ([x]), update "Status", and advance phase.
      - Summarize what happens next in Status.
      - Write plan as Markdown (`gptr_plan.md`) inside workspace subdirectory.
    functions:
      - "fs:*"

  - name: "executor"
    display: "üîé Research Executor"
    description: |
      Executes research workflow by answering each sub-question.
      Runs crawl/search/subagent to gather source material and summarize resource.
      Saves all findings, summaries, and sources to `gptr_notes.md`, keeping track of links for provenance.
    instruction: |
      **Workspace Policy:**
      All notes and results files must be saved inside `[Workspace]/gptr/<sub_folder>`, with `<sub_folder>` based on the user query unless otherwise provided. Ensure subdirectory exists. List all findings and provenance in `gptr_notes.md` within this subfolder.

      For every active research question in `gptr_plan.md`:
      - Run search/web/crawler agents for each.
      - Summarize findings and provide direct source URLs and details.
      - Write all queries, results, and summary blocks to `gptr_notes.md` (never lose provenance!).
      - Mark corresponding phase/status in plan file (`gptr_plan.md`).
      - Log any errors in plan/errors section.
    functions:
      - "fs:*"
      - "web:*"
      - "agent:web/scrape"

  - name: "publisher"
    display: "üì∞ Research Publisher"
    description: |
      Aggregates research findings into the final research report.
      Reads `gptr_notes.md` and creates a well-structured, cited report in `gptr_report.md`.
      Logs report completion to plan, and confirms file path as final output.
    instruction: |
      **Workspace Policy:**
      The final report must be generated in the user's workspace subdirectory: `[Workspace]/gptr/<sub_folder>`, as determined by the query. Unless path is user-overridden, always save/read `gptr_report.md` within this subfolder. Ensure the folder exists. Use `fs:list_roots` to confirm locations.
      
      - Before execution, ensure all phases except publish are [x] checked in `gptr_plan.md`.
      - Read all findings and details in `gptr_notes.md`.
      - Aggregate content and sources into `gptr_report.md`‚Äîwell-structured, cited in Markdown.
      - At end, update plan/status, log completion, and present report file to user.
      - If errors, write them to "Errors Encountered" in plan.
    functions:
      - "fs:*"

###
set: "default"
models:
  any:
    model: "gpt-4o-mini"
    provider: "openai"
    base_url: "https://api.openai.com/v1/"
    api_key: "openai"
