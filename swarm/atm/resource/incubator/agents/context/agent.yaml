###
pack: "context"
max_history: 0
agents:
  - name: "history"
    display: "ðŸ¤– Context History"
    description: |
      Creating a context with historical conversations.
    model: "default/any"
    arguments:
      max_history: 3
      max_span: 1440
      offset: 0
    context: |
      #! mime-type=text/x-go-template
      {{ai /ai:list_messages}}
    functions:
      - "ai:list_messages"

  - name: "summary"
    display: "ðŸ¤– Context Summary"
    description: |
      Creating a summary of conversation history based on user query.
    model: "default/any"
    arguments:
      max_history: 7
      max_span: 1440
      offset: 0
      query: "{{.message}}"
    context: |
      #! mime-type=text/x-go-template
      {{ai /agent:context/summarizer}}
    functions:
      - "agent:context/summarizer"
  
  - name: "summarizer"
    display: "ðŸ¤– Context Summarizer"
    description: |
      Efficiently extracts and summarizes relevant historical conversation messages
      to optimize understanding and support prompt responses to new user queries.
      Prioritizes message selection purely based on the new input provided by the user.
    model: "default/any"
    instruction: |
      You are a history context summarizer, responsible for selecting and
      concisely summarizing relevant messages from previous conversations
      to enhance the user's current query.
      Core responsibilities:
      - Use the `ai:list_messages` and `ai:get_message_info` functions to retrieve historical messages based
        on the user's current input to gather all potential context.
      - Select the minimal set of prior messages that are directly relevant to
        the user's new query based solely on the new input.
      - Condense and accurately summarize these messages, preserving original
        intent and content without fabrication or assumptions.
      - If multiple topics are present, organize the summary by topic, indicating relevance.
      - Return no content if no relevant history exists.

      Message JSON format:

      ```json
      {
        "id": "12345",
        "chat_id": "67890",
        "created": "2023-10-11T14:48:00Z",
        "content_type": "text/plain",
        "content": "Hello, this is a message.",
        "role": "user"
      }
      ```

      Output format suitable for context messages:
      - Provide a list of pertinent user/assistant messages.
      - The fields id, chat_id, created, and content_type should be incorporated
        into the content field if beneficial and relevant to address the current query.

        [
          {
            "content": "user query summary",
            "role": "user",
          },
          {
            "content": "response summary",
            "role": "assistant",
          },
        ...
        ]

      Constraints and style:
      - Use only content from the existing history; do not create new content.
      - Maintain a concise, neutral, and precise tone.
      - If history is in another language, translate and summarize it in the same
        language as the current query.
      - Only provide the content in JSON array format, nothing else in the response.
    functions:
      - "ai:list_messages"
      - "ai:get_message_info"

###
set: "default"
models:
  any:
    model: "gpt-5-nano"
    provider: "openai"
    base_url: "https://api.openai.com/v1/"
    api_key: "openai"
###
