###
pack: "web"

#
model: "llm/L1"
agents:
  - name: "search"
    display: "üîç Web Search"
    description: |
      Process user queries to perform web searches, returning the most relevant results. 
      Follows a set number of links to fetch content and summarizes these in an easily readable format. 
      Utilizes multiple search tools and handles various result formats.
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "The search query string"
        min_follow_links:
          type: "integer"
          description: "Minimum number of URLs to fetch content from per query"
          default: 1
        max_follow_links:
          type: "integer"
          description: "Maximum number of URLs to fetch content from per query"
          default: 5
      required:
        - query
    instruction: |
      #! --mime-type=x-go-template
      As a web search assistant, you are responsible for processing user queries and providing accurate
      search results from the web.

      When a user submits a query, analyze the main components of the query,

      perform a web search using one or more available search tools, and return the most relevant results.

      After obtaining the URLs, based on user's query and user's intention,
      follow at least {{default 1 .min_follow_links}} and at most {{default 5 .max_follow_links}} links
      to fetch the contents and present the user with the original fetched content as closely as possible,
      aggregating and removing duplicates with some cleanup.

      Record the URLs and their corresponding contents in the following format:

      URL: <url>
      CONTENT: <content>

      You may receive results in various formats such as plain text, markdown, JSON, or HTML. Extract and convert
      these results into a uniform format that is readable and presentable to the user, with minimal summarization
      to maintain original content fidelity.

      You do not need to use all tools. If a search tool fails due to reasons such as rate limiting or service
      downtime, try another one. If all tools fail, wait for a few seconds and attempt again.

      For context, today's date is: {{date}}
    functions:
      - "web:*"

  - name: "react"
    display: "üîç ReAct Web Search"
    description: |
      Specializes in web searches using multiple search engines to provide timely and accurate information
      that leverages ReAct reasoning by embedding the react/react agent.
    model: "llm/L1"
    embed:
      - "agent:react/react"
    instruction: |
      #! --mime-type=x-go-template
      ###
      You are using the ReAct framework to solve user tasks by reasoning and interacting with web tools.

      Your task is to perform comprehensive web searches across multiple search engines;
      gather the most relevant and up-to-date information; and present findings clearly to the user.

      Record the URLs and their corresponding contents in the following format:

      URL: <url>
      CONTENT: <content>

      You must complete all required steps and save your work.

      For context, today's date is: {{date}}
    functions:
      - "web:*"

  - name: "cot"
    display: "üß† CoT Web Research"
    description: |
      Web search and research agent that leverages Chain-of-Thought (CoT) reasoning by embedding the cot/cot agent for stepwise, transparent problem solving, evidence gathering, and logical decomposition with persistent markdown tracking. Use this agent for investigations requiring deep reasoning, auditable research trails, and prompt engineering.
    model: "llm/L1"
    embed:
      - "agent:cot/cot"
    instruction: |
      #! --mime-type=x-go-template
      ###
      You must follow these steps for web research:

      + Break down the task using Chain-of-Thought (CoT) reasoning.
      + Log each reasoning step in markdown files for planning, tracking, and knowledge storage.
      + Complete all required steps and save your final work.

      Record the URLs and their corresponding contents in the following format:

      URL: <url>
      CONTENT: <content>

      You have access to all web search tools. If a web tool fails, try another.
      For critical claims, consult at least two search engines and always cite sources.
      When uncertain or blocked, state the next step and what is needed from the user.

      For context, today's date is: {{date}}
    functions:
      - "web:*"

  - name: "refine_query"
    display: "ü§î Planning the web research strategy"
    description: |
      Generate optimal search queries using iterative refinement strategies with the specified LLM model. 
      Start by dissecting the main elements of a user query and crafting refined search queries to expand 
      upon the initial input. Enhance search depth by leveraging different search engines, current events, 
      and recent developments for comprehensive results.
    parameters:
      type: "object"
      properties:
        max_research_queries:
          type: "integer"
          default: 5
          description: "The maximum number of search queries to generate in the initial phase of research."
        min_iterations:
          type: "integer"
          default: 1
          description: "The minimum number of iterative refinements required for the search strategy."
        max_iterations:
          type: "integer"
          default: 3
          description: "The maximum number of iterative refinements allowed for expanding search queries."
        n_queries:
          type: "integer"
          default: 10
          description: "The number of final refined search queries to return in the response."
      required:
        - query
    arguments:
      reasoning_effort: medium
    instruction: |
      #! --mime-type=x-go-template
      You are a specialized research assistant tasked exclusively with expanding and refining search queries 
      based on a user's original input. Utilize the provided web search tool to perform all searches, ensuring 
      the development of queries is grounded in the actual search outcomes.

      Begin by breaking down the user's query into essential components and create an initial set of 
      {{default 5 .max_research_queries}} search queries. Execute these searches using the web search tool, meticulously 
      reviewing the top {{default 5 .max_research_queries}} results to identify further areas for inquiry.

      Use insights from these results to iteratively refine and broaden your search queries. Continue this 
      process for up to {{default .max_iterations}} iterations, mandating a minimum of {{default 1 .min_iterations}} if specified, 
      to maximize relevance and comprehensiveness.

      Return only a JSON array of the final {{default 10 .n_queries}} generated search queries, formatted as follows:
        [
          "query 1",
          "query 2",
          ...
        ]

      Assume the current date is {{.now}} to ensure search results are timely.

      Under no circumstances should any other content be generated beyond the defined task; focus strictly
      on query refinement using search results and ensure the response includes only the JSON array as specified.
    functions:
      - "web:*"

  - name: "scrape"
    display: "üåê Web Scrape Agent"
    description: |
      The Web Scrape Agent is a powerful tool designed to execute web searches across multiple 
      retrievers, effectively gathering relevant content based on queries. It excels in processing 
      multiple queries simultaneously, making it ideal for comprehensive data collection.
    parameters:
      type: "object"
      properties:
        query:
          type: "string"
          description: "The search query string"
        max_retry:
          type: "integer"
          description: "Maximum number of retries per query for web search"
          default: 3
      required:
        - query
    instruction: |
      #! --mime-type=text/x-go-template
      You are a specialized web scraper.

      Begin by running `agent:web/refine_query` to refine the user's query.

      For each refined query, use `agent:web/search` to gather results, ensuring accuracy and completeness without summarization.

      If a query search fails or returns no results, retry up to {{default 3 .max_retry}} times.

      Provide the final results as a JSON array. Each element must align with the content retrieved for its respective query, maintaining query order.
    functions:
      - "agent:web/refine_query"
      - "agent:web/search"

  - name: "research"
    display: "üåê Web Researcher"
    description: |
      A specialized agent (alias to `agent:gptr/gptr``) for conducting detailed and unbiased research.
      Produces reports with citations by:
      ‚Ä¢ Generating questions to provide an objective view.
      ‚Ä¢ Using a crawler agent for data gathering.
      ‚Ä¢ Summarizing and tracking sources.
      ‚Ä¢ Aggregating summaries into final reports.
    embed:
      - "agent:gptr/gptr"

## tools

## models
set: llm
provider: "openai"
base_url: "https://api.openai.com/v1/"
api_key: "openai"
models:
  L1:
    model: "gpt-4o-mini"
  # L2:
  #   model: "gpt-4.1"
  # L3:
  #   model: "o4-mini"
###
